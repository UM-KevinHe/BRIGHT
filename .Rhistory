y[10000]
y[100001]
y[10001]
plot(eta,y,ty="l")
y=2*k1/(1+eta*k1)^3*(eta*k1*d1-c1)+2*k2/(1+eta*k2)^3*(eta*k2*d2-c2)
plot(eta,y,ty="l")
plot(eta[1000:2000],y[1000:2000],ty="l")
plot(eta[5000:6000],y[5000:6000],ty="l")
library(mvtnorm)
A=matrix(c(1,2,3,4), nrow = 2)
A
A=matrix(c(1,2,3,1), nrow = 2)
A
A=matrix(c(1,0.2,0.3,0.2,1,0.3,0.3,0.3,1), nrow = 2)
A=matrix(c(1,0.2,0.3,0.2,1,0.3,0.3,0.3,1), nrow = 3)
A
B=matrix(c(1,0.3,0.3,0.3,1,0.3,0.3,0.3,1), nrow = 3)
B
trace(A%*%B)
trace(A)
A
tr(A)
tr(A)
library(matrix)
library(Matrix)
tr(A)
library(psych)
tr(A)
tr(A%*%B)
tr(B%*%A)
tr(A%*%B%*%B%*%A)
tr(A%*%B%*%A%*%B)
tr(B%*%A%*%A%*%B)
A
B
tr(A%*%B%*%B%*%A)
tr(A%*%B%*%A%*%B)
k1=0.01
k2=0.01
c1=1
c2=10
d1=1
d2=1
eta=(0:10000)/10
c1/k1/d1
c2/k2/d2
k1=0.01
k2=0.01
c1=1
c2=5
d1=1
d2=1
eta=(0:10000)/10
c1/k1/d1
c2/k2/d2
k1=0.01
k2=0.01
c1=1
c2=2
d1=1
d2=1
eta=(0:10000)/10
c1/k1/d1
c2/k2/d2
k1=0.01
k2=0.01
c1=1
c2=2
d1=1
d2=1
eta=(0:10000)/50
c1/k1/d1
c2/k2/d2
(d1+2*c1)/k1/d1
(d2+2*c2)/k2/d2
w=0
y=w*(c1+d1*(eta*k1)^2)/(1+eta*k1)^2+(1-w)(c2+d2*(eta*k2)^2)/(1+eta*k2)^2
plot(eta,y,ty="l")
plot(eta[1:10000],y[1:10000],ty="l")
y
y[1:10]
w
k1=0.01
k2=0.01
c1=1
c2=2
d1=1
d2=1
eta=(0:10000)/50
c1/k1/d1
c2/k2/d2
(d1+2*c1)/k1/d1
(d2+2*c2)/k2/d2
w=0
y=w*(c1+d1*(eta*k1)^2)/(1+eta*k1)^2+(1-w)(c2+d2*(eta*k2)^2)/(1+eta*k2)^2
plot(eta,y,ty="l")
plot(eta[1:10000],y[1:10000],ty="l")
k1=0.01
k2=0.01
c1=1
c2=2
d1=1
d2=1
eta=(0:10000)/50
c1/k1/d1
c2/k2/d2
(d1+2*c1)/k1/d1
(d2+2*c2)/k2/d2
w=0
y=w*(c1+d1*(eta*k1)^2)/(1+eta*k1)^2+(1-w)*(c2+d2*(eta*k2)^2)/(1+eta*k2)^2
plot(eta,y,ty="l")
plot(eta[1:10000],y[1:10000],ty="l")
k1=0.01
k2=0.01
c1=1
c2=1.5
d1=1
d2=1
eta=(0:10000)/50
c1/k1/d1
c2/k2/d2
(d1+2*c1)/k1/d1
(d2+2*c2)/k2/d2
w=0
y=w*(c1+d1*(eta*k1)^2)/(1+eta*k1)^2+(1-w)*(c2+d2*(eta*k2)^2)/(1+eta*k2)^2
plot(eta,y,ty="l")
plot(eta[1:10000],y[1:10000],ty="l")
k1=0.01
k2=0.01
c1=1
c2=1.5
d1=1
d2=1
eta=(2500:10000)/50
c1/k1/d1
c2/k2/d2
(d1+2*c1)/k1/d1
(d2+2*c2)/k2/d2
w=0
y=w*(c1+d1*(eta*k1)^2)/(1+eta*k1)^2+(1-w)*(c2+d2*(eta*k2)^2)/(1+eta*k2)^2
plot(eta,y,ty="l")
k1=0.01
k2=0.01
c1=1
c2=1.5
d1=1
d2=1
eta=(2500:10000)/50
c1/k1/d1
c2/k2/d2
(d1+2*c1)/k1/d1
(d2+2*c2)/k2/d2
w=1
y=w*(c1+d1*(eta*k1)^2)/(1+eta*k1)^2+(1-w)*(c2+d2*(eta*k2)^2)/(1+eta*k2)^2
plot(eta,y,ty="l")
plot(eta,y,ty="l")
k1=0.01
k2=0.01
c1=1
c2=1.5
d1=1
d2=1
eta=(2500:10000)/50
c1/k1/d1
c2/k2/d2
(d1+2*c1)/k1/d1
(d2+2*c2)/k2/d2
w=0.5
y=w*(c1+d1*(eta*k1)^2)/(1+eta*k1)^2+(1-w)*(c2+d2*(eta*k2)^2)/(1+eta*k2)^2
plot(eta,y,ty="l")
plot(eta,y,ty="l")
k1=0.01
k2=0.01
c1=1
c2=1.5
d1=1
d2=1
eta=(2500:10000)/50
c1/k1/d1
c2/k2/d2
(d1+2*c1)/k1/d1
(d2+2*c2)/k2/d2
w=0
y=w*(c1+d1*(eta*k1)^2)/(1+eta*k1)^2+(1-w)*(c2+d2*(eta*k2)^2)/(1+eta*k2)^2
plot(eta,y,ty="l")
k1=0.01
k2=0.01
c1=1
c2=1.5
d1=1
d2=1
eta=(2500:10000)/50
c1/k1/d1
c2/k2/d2
k1=0.01
k2=0.02
c1=1
c2=1.5
d1=1
d2=1
eta=(2500:10000)/50
c1/k1/d1
c2/k2/d2
k1=0.01
k2=0.005
c1=1
c2=1.5
d1=1
d2=1
eta=(2500:10000)/50
c1/k1/d1
c2/k2/d2
k1=0.01
k2=0.005
c1=1
c2=1.5
d1=1
d2=1
eta=(2500:10000)/50
c1/k1/d1
c2/k2/d2
k1=0.01
k2=0.005
c1=1
c2=1.5
d1=1
d2=1
eta=(2500:10000)/50
c1/k1/d1
c2/k2/d2
(d1+2*c1)/k1/d1
(d2+2*c2)/k2/d2
k1=0.01
k2=0.01
c1=1
c2=2
d1=1
d2=1
eta=(2500:10000)/50
c1/k1/d1
c2/k2/d2
(d1+2*c1)/k1/d1
(d2+2*c2)/k2/d2
k1=0.01
k2=0.01
c1=1
c2=4
d1=1
d2=1
eta=(2500:10000)/50
c1/k1/d1
c2/k2/d2
(d1+2*c1)/k1/d1
(d2+2*c2)/k2/d2
k1=0.01
k2=0.01
c1=1
c2=4
d1=1
d2=1
eta=(500:10000)/10
c1/k1/d1
c2/k2/d2
(d1+2*c1)/k1/d1
(d2+2*c2)/k2/d2
y=(c1+d1*(eta*k1)^2)/(1+eta*k1)^2+(c2+d2*(eta*k2)^2)/(1+eta*k2)^2
plot(eta,y,ty="l")
y=2*k1/(1+eta*k1)^3*(eta*k1*d1-c1)+2*k2/(1+eta*k2)^3*(eta*k2*d2-c2)
plot(eta,y,ty="l")
k1=0.01
k2=0.01
c1=1
c2=4
d1=1
d2=1
eta=(1:10000)/10
c1/k1/d1
c2/k2/d2
(d1+2*c1)/k1/d1
(d2+2*c2)/k2/d2
w=0
y=(c1+d1*(eta*k1)^2)/(1+eta*k1)^2+(c2+d2*(eta*k2)^2)/(1+eta*k2)^2
plot(eta,y,ty="l")
plot(eta,y,ty="l")
y=2*k1/(1+eta*k1)^3*(eta*k1*d1-c1)+2*k2/(1+eta*k2)^3*(eta*k2*d2-c2)
y[3000]
k1=0.01
k2=0.005
c1=1
c2=2
d1=1
d2=1
eta=(1:10000)/10
c1/k1/d1
c2/k2/d2
(d1+2*c1)/k1/d1
(d2+2*c2)/k2/d2
y=(c1+d1*(eta*k1)^2)/(1+eta*k1)^2+(c2+d2*(eta*k2)^2)/(1+eta*k2)^2
plot(eta,y,ty="l")
k1=0.01
k2=0.005
c1=1
c2=2
d1=1
d2=1
eta=(1:10000)/10
c1/k1/d1
c2/k2/d2
(d1+2*c1)/k1/d1
(d2+2*c2)/k2/d2
w=0
y=w*(c1+d1*(eta*k1)^2)/(1+eta*k1)^2+(1-w)(c2+d2*(eta*k2)^2)/(1+eta*k2)^2
plot(eta,y,ty="l")
k1=0.01
k2=0.005
c1=1
c2=2
d1=1
d2=1
eta=(1:10000)/10
c1/k1/d1
c2/k2/d2
(d1+2*c1)/k1/d1
(d2+2*c2)/k2/d2
w=0
y=w*(c1+d1*(eta*k1)^2)/(1+eta*k1)^2+(1-w)*(c2+d2*(eta*k2)^2)/(1+eta*k2)^2
plot(eta,y,ty="l")
k1=0.01
k2=0.005
c1=1
c2=2
d1=1
d2=1
eta=(1:10000)/10
c1/k1/d1
c2/k2/d2
(d1+2*c1)/k1/d1
(d2+2*c2)/k2/d2
w=1
y=w*(c1+d1*(eta*k1)^2)/(1+eta*k1)^2+(1-w)*(c2+d2*(eta*k2)^2)/(1+eta*k2)^2
plot(eta,y,ty="l")
k1=0.01
k2=0.005
c1=1
c2=2
d1=1
d2=1
eta=(1:10000)/10
c1/k1/d1
c2/k2/d2
(d1+2*c1)/k1/d1
(d2+2*c2)/k2/d2
w=0.5
y=w*(c1+d1*(eta*k1)^2)/(1+eta*k1)^2+(1-w)*(c2+d2*(eta*k2)^2)/(1+eta*k2)^2
plot(eta,y,ty="l")
k1=0.01
k2=0.005
k3=0.01
c1=1
c2=2
c3=3
d1=1
d2=1
d3=1
eta=(1:10000)/10
c1/k1/d1
c2/k2/d2
c3/k3/d3
(d1+2*c1)/k1/d1
(d2+2*c2)/k2/d2
(d3+2*c3)/k3/d3
k1=0.01
k2=0.005
k3=0.02
c1=1
c2=2
c3=6
d1=1
d2=1
d3=1
eta=(1:10000)/10
c1/k1/d1
c2/k2/d2
c3/k3/d3
X=matrix(rnorm(100),nrow=10)
X
X%*%solve(t(X)%*%X)t(X)
X%*%solve(t(X)%*%X)%*%t(X)
3.79+3.79+4.99+4.59+5.79
eta_vec=c(0,exp(seq(log(0.01),log(100),length.out=100)),10000)
eta_vec
1000/60
20*60
1200*6ã€‚87
1200*6.87
library(lassosum)
devtools::install_github("tengfei-emory/lcphR")
library(grepreg)
library(grpreg)
newY <- function(y, family) {
if (is.data.frame(y)) y <- as.matrix(y)
if (is.matrix(y)) {
d <- dim(y)
y <- t(y)
} else {
d <- c(length(y), 1)
}
# Convert fuzzy binomial data
if (family=="binomial" && typeof(y) != "logical") {
tab <- table(y)
if (length(tab) > 2) stop("Attemping to use family='binomial' with non-binary data", call.=FALSE)
if (!identical(names(tab), c("0", "1"))) {
message(paste0("Logistic regression modeling Pr(y=", names(tab)[2], ")"))
y <- as.double(as.character(y) == names(tab)[2])
if (d[2] > 1) attr(y, "dim") <- d
}
}
# Convert to double, if necessary
if (typeof(y) != "double") {
tryCatch(storage.mode(y) <- "double", warning=function(w) {stop("y must be numeric or able to be coerced to numeric", call.=FALSE)})
}
if (any(is.na(y))) stop("Missing data (NA's) detected in outcome y.  You must eliminate missing data (e.g., by removing cases or imputation) before passing y to grpreg", call.=FALSE)
# Handle multi
if (is.matrix(y)) {
if (ncol(y) > 1) {
if (is.null(colnames(y))) paste("Y", 1:ncol(y), sep="")
}
attributes(y) <- NULL
}
if (family=="gaussian") {
meanY <- mean(y)
y <- y - meanY
attr(y, "mean") <- meanY
}
attr(y, "m") <- d[2]
y
}
y=rnorm(10000,mean = 10,sd=10)
ny=newY(y,"gaussian")
mean(ny)
sd(ny)
install.packages("pkgdown")
0.8/log(0.8/0.5)
0.2/log(0.2/0.1)+0.6/log(0.6/0.4)
0.8/log(0.8/0.2)
0.2/log(0.2/0.1)+0.6/log(0.6/0.1)
0.2/log(0.2/0.05)+0.6/log(0.6/0.15)
0.2/log(0.2/0.15)+0.6/log(0.6/0.05)
0.47704/0.18111
0.01896/0.00273
(0.47704/0.18111)^2
c(0.5,0.25,0.2,0.15)
a=c(0.5,0.25,0.2,0.15)
cumsum(a)
var=0.8
data.use=a
which(cumsum(data.use)>var)[1]
a=rnorm(10000000)
var(a)
mean(a)
setwd("~/Desktop/research/Kevin He/PRS/Rewrite_Lassosum/example_2/")
p2cor <- function(p, n, sign=rep(1, length(p))) {
stopifnot(length(n)==1 || length(n) == length(p))
stopifnot(length(p) == length(sign))
t <- sign(sign) * qt(p/2, df=n-2, lower.tail=F)
return(t / sqrt(n - 2 + t^2))
}
for(i in c("SAS1","SAS2","EUR")){
GWAS=read.table(paste(i,".qassoc",sep=""),header=T)
bim=read.table(paste(i,".bim",sep=""),header=F)
print(sum(bim[,2]==GWAS[,2]))
GWAS_rst=data.frame(bim[,1],bim[,4],bim[,5],bim[,6],sign(GWAS[,5]),GWAS[,4],GWAS[,9])
colnames(GWAS_rst)=c("CHR","BP","A1","A2","Sign","N","P")
IProd_rst=data.frame(bim[,1],bim[,4],bim[,5],bim[,6],p2cor(GWAS[,9],GWAS[,4],sign(GWAS[,5])))
colnames(IProd_rst)=c("CHR","BP","A1","A2","IProd")
write.table(GWAS_rst,file=paste(i,".GWAS",sep=""),col.names = T,row.names = F,quote = F)
write.table(IProd_rst,file=paste(i,".IProd",sep=""),col.names = T,row.names = F,quote = F)
}
setwd("~/Desktop/research/Kevin He/PRS/Rewrite_Lassosum/example_2/")
p2cor <- function(p, n, sign=rep(1, length(p))) {
stopifnot(length(n)==1 || length(n) == length(p))
stopifnot(length(p) == length(sign))
t <- sign(sign) * qt(p/2, df=n-2, lower.tail=F)
return(t / sqrt(n - 2 + t^2))
}
for(i in c("SAS1","SAS2","EUR")){
GWAS=read.table(paste(i,".qassoc",sep=""),header=T)
bim=read.table(paste(i,".bim",sep=""),header=F)
print(sum(bim[,2]==GWAS[,2]))
GWAS_rst=data.frame(bim[,1],bim[,4],bim[,5],bim[,6],sign(GWAS[,5]),GWAS[,4],GWAS[,9])
colnames(GWAS_rst)=c("CHR","BP","A1","A2","Sign","N","P")
IProd_rst=data.frame(bim[,1],bim[,4],bim[,5],bim[,6],p2cor(GWAS[,9],GWAS[,4],sign(GWAS[,5])))
colnames(IProd_rst)=c("CHR","BP","A1","A2","IProd")
write.table(GWAS_rst,file=paste(i,".GWAS",sep=""),col.names = T,row.names = F,quote = F)
write.table(IProd_rst,file=paste(i,".IProd",sep=""),col.names = T,row.names = F,quote = F)
}
setwd("~/Desktop/research/Kevin He/PRS/Rewrite_Lassosum/new_BRIGHT/BRIGHT/")
library(devtools)
library(pkgdown)
load_all()
Tind <- "GWAS"
Tss <- read.table("~/Desktop/research/Kevin He/PRS/Rewrite_Lassosum/example_2/SAS1_train.GWAS",header = T)
head(Tss)
Pind <- c("GWAS")
Pss <- read.table("~/Desktop/research/Kevin He/PRS/Rewrite_Lassosum/example_2/EUR.GWAS",header = T)
head(Pss)
Tref <- "~/Desktop/research/Kevin He/PRS/Rewrite_Lassosum/example_2/SAS1_train"
Pref <- "~/Desktop/research/Kevin He/PRS/Rewrite_Lassosum/example_2/EUR"
dat=PreprocessS(Tss, Tind, Tref, Pss, Pind, Pref, TLDblocks=c("SAS.hg19"), PLDblocks=c("EUR.hg19"),TN=100,PN=11514)
#eta_vec=c(0,exp(seq(log(0.1),log(10),length.out=20)))
out <- BRIGHTs(data = dat)
Eta_curve.plot(out,valid.type = "AIC")
